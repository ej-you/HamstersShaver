# -----
# BUILD
# -----

FROM golang:1.22.4-alpine3.20 AS build

# set up workdir
WORKDIR /go/src

# install dependences
COPY ./go.mod .
COPY ./go.sum .
RUN go mod download

# copy project files to container
COPY . .

# compile app
RUN go build -o ./rest_api ./main.go

# ---
# RUN
# ---

FROM alpine:3.20 AS run

# make dir for logs
RUN mkdir /logs

WORKDIR /app
# copy compiled file and Makefile to run app
COPY --from=build /go/src/rest_api .
COPY --from=build /go/src/settings/config/wallet.json ./settings/config/wallet.json
COPY --from=build /go/src/docs ./docs

# run app
CMD ["/app/rest_api", ">>", "/logs/info-log.log", "2>>", "/logs/error-log.log"]
